package me.flamboo.graves;

import org.bukkit.Bukkit;
import org.bukkit.ChatColor;
import org.bukkit.Effect;
import org.bukkit.Location;
import org.bukkit.Material;
import org.bukkit.Sound;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.entity.EntityDeathEvent;
import org.bukkit.event.entity.PlayerDeathEvent;
import org.bukkit.event.player.PlayerCommandPreprocessEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.plugin.java.JavaPlugin;
import org.bukkit.potion.PotionEffect;
import org.bukkit.potion.PotionEffectType;
import org.bukkit.scheduler.BukkitRunnable;

import com.gmail.filoghost.holograms.api.FloatingItem;
import com.gmail.filoghost.holograms.api.Hologram;
import com.gmail.filoghost.holograms.api.HolographicDisplaysAPI;
import com.gmail.filoghost.holograms.api.PickupHandler;

public class Graves extends JavaPlugin implements Listener{
	
	public void onEnable(){
		
		if (!Bukkit.getPluginManager().isPluginEnabled("HolographicDisplays")) {
			getLogger().severe("*** HolographicDisplays is not installed or not enabled. ***");
			getLogger().severe("*** This plugin will be disabled. ***");
			this.setEnabled(false);
			return;
		}
		
		Bukkit.getServer().getPluginManager().registerEvents(this, this);
		
	
	
	
	for (Hologram hologram : HolographicDisplaysAPI.getHolograms(this));
		}

	
	@EventHandler
    public void onPlayerDeath(PlayerDeathEvent e){
		Location loc = e.getEntity().getLocation().add(0.0, 2.0, 0.0);
		ItemStack itemStack = new ItemStack(Material.NETHER_STAR);
		final FloatingItem floatingItem = HolographicDisplaysAPI.createFloatingItem(this, loc, itemStack);
        final Hologram h = HolographicDisplaysAPI.createHologram(this,
                e.getEntity().getLocation().add(0, 5, 0),
                ChatColor.AQUA + e.getEntity().getDisplayName(),
                ChatColor.AQUA + "Was Killed Here");
        
        new BukkitRunnable(){ //The runnable is within the event
            @Override
            public void run(){
            	floatingItem.delete();
            	h.delete();//delete the hologram
            }
        }.runTaskLater(this, 600*20);//the delay is 300(5min) * 20ticks.
    }
}
